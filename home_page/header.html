<!-- Header -->
<% var hs=(typeof siteSettings !=='undefined' && siteSettings.header) ? siteSettings.header : {}; var logoPos=(hs.logo
    && hs.logo.position) || 'center' ; var menuPos=(hs.menu && hs.menu.position) || 'left' ; var menuRow=(hs.menu &&
    hs.menu.row) || 'top' ; var searchEnabled=hs.search ? hs.search.enabled !==false : true; var searchPos=(hs.search &&
    hs.search.position) || 'left' ; var customerAccount=hs.customerAccount !==false; var headerFont=hs.font || 'heading'
    ; var headerFontSize=hs.fontSize || '16px' ; var headerWidth=(hs.appearance && hs.appearance.width) || 'full' ; var
    headerHeight=(hs.appearance && hs.appearance.height) || 'standard' ; var stickyHeader=hs.stickyHeader || 'always' ;
    var borderThickness=hs.borderThickness || 0; var stickyClass=stickyHeader==='always' ? 'header-sticky' :
    (stickyHeader==='on-scroll-up' ? 'header-sticky-scroll' : '' ); var heightPad=headerHeight==='compact' ? '8px 0'
    : '14px 0' ; var widthStyle=headerWidth==='page' ? 'max-width: 1200px; margin: 0 auto;' : '' ; var
    fontFamily=headerFont==='heading' ? ((typeof siteSettings !=='undefined' && siteSettings.theme &&
    siteSettings.theme.typography) ? siteSettings.theme.typography.headingFontFamily : 'Playfair Display, serif' ) :
    ((typeof siteSettings !=='undefined' && siteSettings.theme && siteSettings.theme.typography) ?
    siteSettings.theme.typography.fontFamily : 'Outfit, sans-serif' ); /* Flex order for logo / menu / icons based on
    position settings */ var logoOrder=logoPos==='left' ? 1 : (logoPos==='right' ? 3 : 2); var
    menuOrder=menuPos==='left' ? 1 : (menuPos==='right' ? 3 : 2); /* Icons always go to the side opposite the menu, or
    far-right if menu is centered */ var iconsOrder=menuPos==='right' ? 1 : 3; /* Hamburger follows menu */ var
    hamburgerOrder=menuOrder; %>
    <header class="<%= stickyClass %>"
        style="border-bottom: <%= borderThickness %>px solid rgba(0,0,0,0.1); font-family: <%= fontFamily %>; font-size: <%= headerFontSize %>;">
        <nav style="padding: <%= heightPad %>; <%= widthStyle %>">
            <button class="hamburger" aria-label="Toggle navigation" onclick="toggleNav()"
                style="order: <%= hamburgerOrder %>">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>

            <ul class="nav-links" style="order: <%= menuOrder %>">
                <% siteSettings.navigation.headerLinks.forEach(function(link) { %>
                    <li><a href="<%= link.url %>">
                            <%= link.label %>
                        </a></li>
                    <% }); %>
            </ul>

            <div class="logo"
                style="order: <%= logoOrder %>; <% if (logoPos === 'center') { %>text-align:center; flex:1;<% } %>">
                <% if (siteSettings.media.logo) { %>
                    <img src="<%= siteSettings.media.logo %>" alt="<%= siteSettings.branding.websiteTitle %>"
                        style="max-height: 40px;">
                    <% } else { %>
                        <%= siteSettings.branding.websiteTitle.split(' ')[0] || ' Store' %>
                            <% } %>
            </div>

            <div class="nav-icons" style="order: <%= iconsOrder %>">
                <% if (searchEnabled) { %>
                    <button class="icon-btn" aria-label="Search" onclick="openSearch()"
                        style="order: <%= searchPos === 'left' ? 1 : 3 %>">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                    <% } %>
                        <% if (customerAccount) { %>
                            <button class="icon-btn" aria-label="Account" onclick="toggleAccountPopup(event)"
                                style="order: 2">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </button>
                            <!-- Account Popup -->
                            <div id="accountPopup" class="account-popup">
                                <!-- Logged Out State -->
                                <div id="loggedOutState">
                                    <h2
                                        style="font-family: 'Playfair Display', serif; font-size: 1.2rem; margin-bottom: 12px; color: #000;">
                                        Account</h2>
                                    <button class="signin-btn" onclick="handleSignIn()">Sign in</button>
                                    <button class="signup-btn" onclick="handleSignUp()">Sign up</button>
                                </div>

                                <!-- Logged In State -->
                                <div id="loggedInState" style="display: none;">
                                    <h2
                                        style="font-family: 'Playfair Display', serif; font-size: 1.1rem; margin-bottom: 5px; color: #000;">
                                        Hi,</h2>
                                    <p id="userEmail"
                                        style="font-size: 0.85rem; color: #666; margin-bottom: 15px; word-break: break-all;">
                                    </p>
                                    <button class="signout-btn" onclick="handleSignOut()">Sign out</button>
                                </div>

                                <div class="account-actions">
                                    <button class="action-btn" onclick="handleOrders()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                            <line x1="3" y1="6" x2="21" y2="6"></line>
                                            <path d="M16 10a4 4 0 0 1-8 0"></path>
                                        </svg>
                                        Orders
                                    </button>
                                    <button class="action-btn" onclick="handleProfile()">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        Profile
                                    </button>
                                </div>
                            </div>
                            <% } %>
                                <button class="cart-icon" aria-label="Shopping cart" onclick="openCart()"
                                    style="order: 4">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                        <line x1="3" y1="6" x2="21" y2="6"></line>
                                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                                    </svg>
                                    <span id="cartBadge" class="cart-badge" style="display:none;">0</span>
                                </button>
            </div>
        </nav>
        <div id="mobileOverlay" class="mobile-overlay" onclick="toggleNav(false)"></div>
    </header>
    <script src="/js/customizer-preview.js"></script>