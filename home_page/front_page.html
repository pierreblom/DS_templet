<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shopbeha.com - The Most Comfortable Bra</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-color: #F9F5F0;
            --text-color: #1A1A1A;
            --accent-color: #A0522D;
            /* Terracotta */
            --accent-hover: #8B4513;
            --header-bg: #FFFFFF;
            --card-bg: #FFFFFF;
            --border-color: #E5E5E5;
            --soft-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
        }

        /* Header */
        header {
            background: var(--header-bg);
            padding: 1rem 5%;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            letter-spacing: -0.5px;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            transition: color 0.3s;
            text-transform: uppercase;
        }

        .nav-links a:hover {
            color: var(--accent-color);
        }

        .nav-icons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .icon-btn,
        .cart-icon {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 0.5rem;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover,
        .cart-icon:hover {
            color: var(--accent-color);
        }

        .cart-icon {
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: 0;
            right: -5px;
            background: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Mobile Menu */
        .hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
        }

        .mobile-overlay.show {
            display: block;
        }

        @media (max-width: 768px) {
            .hamburger {
                display: block;
            }

            .nav-links {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                width: 80%;
                max-width: 300px;
                background: white;
                flex-direction: column;
                padding: 5rem 2rem;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1002;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .nav-links.open {
                transform: translateX(0);
            }

            .logo {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
            }
        }

        /* Hero Section */
        .hero {
            padding: 6rem 5%;
            width: 100%;
            max-width: none;
            margin: 0;
            display: flex;
            align-items: center;
            min-height: 80vh;
            background-image: url('images/hero_image/hero.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        .hero-content {
            max-width: 600px;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            line-height: 1.1;
            margin-bottom: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            text-transform: uppercase;
        }

        .hero p {
            font-size: 1.1rem;
            margin-bottom: 2.5rem;
            color: #666;
        }

        .cta-button {
            background-color: var(--accent-color);
            color: white;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cta-button:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(160, 82, 45, 0.2);
        }

        .customer-love {
            margin-top: 4rem;
        }

        .love-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1.5rem;
            color: #999;
        }

        .love-items {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .love-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .stars {
            color: #FFB800;
            font-size: 0.9rem;
        }

        .review-text {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .reviewer {
            font-size: 0.8rem;
            color: #888;
        }

        @media (max-width: 900px) {
            .hero {
                justify-content: center;
                text-align: center;
                padding-top: 4rem;
            }

            .hero-content {
                margin: 0 auto;
            }

            .love-items {
                justify-content: center;
            }

            .hero-image-container {
                height: 400px;
            }
        }

        /* Sections */
        section {
            padding: 4rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 3rem;
            color: var(--text-color);
            font-weight: 600;
        }

        /* Categories */
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--soft-shadow);
            transition: transform 0.3s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .category-image {
            height: 250px;
            background: #EAE0D5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .category-card h3 {
            padding: 1rem;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Products */
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--soft-shadow);
            transition: transform 0.3s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-image {
            height: 320px;
            background: #F0EBE5;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .product-image .hover-img {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
        }

        .product-card:hover .main-img {
            opacity: 0;
            transform: scale(1.05);
        }

        .product-card:hover .hover-img {
            opacity: 1;
            transform: scale(1.05);
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .rating {
            color: #FFB800;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .price {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .add-button {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--text-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        .add-button:hover {
            background-color: var(--accent-color);
        }

        /* Footer */
        footer {
            background-color: #F2EFE9;
            padding: 4rem 5% 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 3rem;
            max-width: 1400px;
            margin: 0 auto;
            padding-bottom: 3rem;
            border-bottom: 1px solid #DDD;
        }

        .footer-column h4 {
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-color);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column a {
            color: #666;
            text-decoration: none;
            transition: color 0.3s;
            font-size: 0.95rem;
        }

        .footer-column a:hover {
            color: var(--accent-color);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            color: #888;
            font-size: 0.9rem;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
            transition: transform 0.3s;
        }

        .social-icon:hover {
            transform: scale(1.1);
        }

        .footer-payment {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid #EEE;
            margin-top: 2rem;
        }

        .payment-logos {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .payment-logo {
            height: 20px;
            width: auto;
            opacity: 0.7;
            filter: grayscale(100%);
            transition: opacity 0.3s;
        }

        .payment-logo:hover {
            opacity: 1;
            filter: grayscale(0%);
        }

        /* Modals & Drawers */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Cart Drawer */
        .cart-panel {
            margin-left: auto;
            max-width: 450px;
            width: 100%;
            height: 100vh;
            border-radius: 0;
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .modal.show-right {
            justify-content: flex-end;
        }

        .modal.show-right .cart-panel {
            transform: translateX(0);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .cart-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .checkout-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 1rem;
            width: 100%;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
        }

        /* Admin & Edit Buttons */
        .edit-product-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .product-card:hover .edit-product-btn {
            display: flex;
        }

        .admin-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--text-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            z-index: 100;
        }

        .admin-panel button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Search Styles */
        .search-input-container input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-result-item {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-result-item:hover {
            background: #f9f9f9;
        }

        /* New Arrivals Section */
        .new-arrivals-section {
            position: relative;
            width: 100%;
            height: 700px;
            /* Increased height for better visibility */
            display: flex;
            align-items: flex-end;
            /* Move card to bottom */
            justify-content: center;
            padding-bottom: 4rem;
            /* Spacing from the bottom */
            margin-top: 4rem;
            overflow: hidden;
        }

        .new-arrivals-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('images/arrivals.png');
            background-size: cover;
            background-position: center;
            z-index: 1;
        }

        .new-arrivals-card {
            position: relative;
            z-index: 2;
            background: white;
            padding: 3rem;
            max-width: 500px;
            text-align: center;
            border: 8px solid #E0F2F1;
            /* Light blue border from mockup */
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .new-arrivals-card h2 {
            font-family: 'Playfair Display', serif;
            /* Serif font for title */
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .new-arrivals-card p {
            font-size: 1.1rem;
            color: #444;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .new-arrivals-section {
                height: 500px;
            }

            .new-arrivals-card {
                margin: 0 5%;
                padding: 2rem;
            }

            .new-arrivals-card h2 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <%- include('header.html') %>

        <!-- Home Page -->
        <section id="home" class="page active" style="padding: 0; max-width: none;">
            <%- include('hero.html') %>

                <!-- Customer Love Section -->
                <section class="customer-love-section"
                    style="background: white; padding: 4rem 5%; border-bottom: 1px solid var(--border-color);">
                    <div style="max-width: 1400px; margin: 0 auto;">
                        <div class="love-title">CUSTOMER LOVE</div>
                        <div class="love-items">
                            <div class="love-item">
                                <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                                <div class="review-text">"Best bra ever!"</div>
                                <div class="reviewer">Lindive M.</div>
                            </div>
                            <div class="love-item">
                                <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                                <div class="review-text">"So comfortable"</div>
                                <div class="reviewer">Sarah K.</div>
                            </div>
                            <div class="love-item">
                                <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                                <div class="review-text">"Perfect fit"</div>
                                <div class="reviewer">Thandi S.</div>
                            </div>
                        </div>
                    </div>
                </section>

                <div style="max-width: 1400px; margin: 0 auto; padding: 4rem 5%;">
                    <%- include('trail_favorites.html') %>
                </div>

                <!-- New Arrivals Section -->
                <section class="new-arrivals-section">
                    <div class="new-arrivals-bg"></div>
                    <div class="new-arrivals-card">
                        <h2>New Arrivals!</h2>
                        <p>Discover our latest designs that celebrate every body.</p>
                        <a href="#shop" class="cta-button">SHOP NOW</a>
                    </div>
                </section>
        </section>

        <%- include('value_props.html') %>
            <%- include('newsletter.html') %>
                <%- include('footer.html') %>

                    <%- include('../admin_panel/cart_modal.html') %>
                        <%- include('../admin_panel/checkout_modal.html') %>
                            <%- include('../admin_panel/edit_trail_favorites_modal.html') %>
                                <%- include('../admin_panel/add_product_modal.html') %>

                                    <script>
                                        // Sample product data (fallback if no saved state)
                                        let products = [
                                            {
                                                id: 1,
                                                name: "The Snap & Go Bra",
                                                price: 359.00,
                                                rating: 4.8,
                                                category: "bras",
                                                isTrailFavorite: true,
                                                image: "images/product_1_The_Snap_&_Go_Bra/1.png",
                                                hoverImage: "images/product_1_The_Snap_&_Go_Bra/2.png"
                                            },
                                            {
                                                id: 2,
                                                name: "The Ultimate Coverage Bra",
                                                price: 459.00,
                                                rating: 5.0,
                                                category: "bras",
                                                isTrailFavorite: true,
                                                image: "images/product_2_The_Ultimate_Coverage_Bra/1.png",
                                                hoverImage: "images/product_2_The_Ultimate_Coverage_Bra/2.png"
                                            },
                                            {
                                                id: 3,
                                                name: "The Posture Perfect Shaper",
                                                price: 520.00,
                                                rating: 4.9,
                                                category: "shapewear",
                                                isTrailFavorite: true,
                                                image: "images/product_3_The_Posture_Perfect_Shaper/1.png",
                                                hoverImage: "images/product_3_The_Posture_Perfect_Shaper/2.png"
                                            },
                                            {
                                                id: 4,
                                                name: "The High Compression Bodysuit",
                                                price: 899.00,
                                                rating: 4.7,
                                                category: "shapewear",
                                                isTrailFavorite: true,
                                                image: "images/product_4_The_High_Compression_Bodysuit/1.png",
                                                hoverImage: "images/product_4_The_High_Compression_Bodysuit/2.png"
                                            },
                                            {
                                                id: 5,
                                                name: "The Glimmer Bra",
                                                price: 450.00,
                                                rating: 4.6,
                                                category: "bras",
                                                isTrailFavorite: true,
                                                image: "images/product_5_The_Glimmer_Bra/1.png",
                                                hoverImage: "images/product_5_The_Glimmer_Bra/2.png"
                                            },
                                            {
                                                id: 6,
                                                name: "The Active Zip Bra",
                                                price: 399.00,
                                                rating: 4.5,
                                                category: "bras",
                                                isTrailFavorite: true,
                                                image: "images/product_6_The_Active_Zip_Bra/1.png",
                                                hoverImage: "images/product_6_The_Active_Zip_Bra/2.png"
                                            },
                                            {
                                                id: 7,
                                                name: "The 24/7 Seamless Bra",
                                                price: 350.00,
                                                rating: 4.9,
                                                category: "bras",
                                                isTrailFavorite: true,
                                                image: "images/product_7_The_24.7 Seamless Bra/1.png",
                                                hoverImage: "images/product_7_The_24.7 Seamless Bra/2.png"
                                            },
                                            {
                                                id: 8,
                                                name: "The Seamless Soft Bra",
                                                price: 299.00,
                                                rating: 5.0,
                                                category: "bras",
                                                isTrailFavorite: true,
                                                image: "images/product_8_The_Seamless_Soft_Bra/1.png",
                                                hoverImage: "images/product_8_The_Seamless_Soft_Bra/2.png"
                                            }
                                        ];

                                        // Persistence helpers
                                        const STORAGE_KEY = 'auraflex_products_v1';
                                        function loadProductsFromStorage() {
                                            try {
                                                const raw = localStorage.getItem(STORAGE_KEY);
                                                if (!raw) return null;
                                                const parsed = JSON.parse(raw);
                                                if (!Array.isArray(parsed)) return null;
                                                return parsed;
                                            } catch (_) {
                                                return null;
                                            }
                                        }
                                        function saveProductsToStorage() {
                                            try {
                                                localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
                                            } catch (_) {
                                                // ignore storage errors
                                            }
                                        }

                                        // Debug logging to terminal
                                        function debugLog(message) {
                                            console.log(message);
                                            fetch(`/log?msg=${encodeURIComponent(message)}`).catch(() => { });
                                        }

                                        // Initialize the page
                                        document.addEventListener('DOMContentLoaded', function () {
                                            debugLog('ðŸš€ ShopBeha: Page loaded, initializing...');
                                            const stored = loadProductsFromStorage();
                                            if (stored) {
                                                debugLog(`ðŸ“¦ ShopBeha: Loaded products from localStorage: ${stored.length} items`);
                                                products = stored;
                                            } else {
                                                debugLog(`ðŸ“¦ ShopBeha: Using default products: ${products.length} items`);
                                            }
                                            renderTrailFavorites();
                                            populateProductLists();
                                            updateCartBadge();
                                            // Initialize promo field if present
                                            const promo = (function () { try { return JSON.parse(localStorage.getItem('auraflex_promo_v1')) || {}; } catch (_) { return {}; } })();
                                            const promoInput = document.getElementById('promoCode');
                                            if (promoInput && promo.code) promoInput.value = promo.code;
                                            debugLog('âœ… ShopBeha: Initialization complete');
                                        });

                                        // Render Trail Favorites on the homepage
                                        function renderTrailFavorites() {
                                            const container = document.getElementById('trail-favorites-container');
                                            if (!container) return;
                                            container.innerHTML = '';

                                            const trailFavorites = products.filter(product => product.isTrailFavorite);

                                            trailFavorites.forEach(product => {
                                                const productCard = document.createElement('div');
                                                productCard.className = 'product-card';

                                                // Generate star rating
                                                const fullStars = Math.floor(product.rating);
                                                const halfStar = product.rating % 1 >= 0.5;
                                                let stars = '';

                                                for (let i = 0; i < fullStars; i++) {
                                                    stars += 'â˜…';
                                                }

                                                if (halfStar) {
                                                    stars += 'Â½';
                                                }

                                                // Fill remaining stars with empty stars
                                                const emptyStars = 5 - Math.ceil(product.rating);
                                                for (let i = 0; i < emptyStars; i++) {
                                                    stars += 'â˜†';
                                                }

                                                productCard.innerHTML = `
                    <div class="product-image" onclick="openProductPage(${product.id}, '${product.name}', ${product.price})">
                        <img src="${product.image}" alt="${product.name}" class="main-img">
                        ${product.hoverImage ? `<img src="${product.hoverImage}" alt="${product.name} hover" class="hover-img">` : ''}
                    </div>
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <div class="rating" aria-label="Rated ${product.rating} out of 5">${stars} (${product.rating}/5)</div>
                        <div class="price">R ${product.price.toFixed(2)}</div>
                        <button class="add-button" aria-label="Quick add ${product.name} to cart" onclick="quickAdd(${product.id})">ADD TO CART</button>
                    </div>
                `;

                                                container.appendChild(productCard);
                                            });
                                        }

                                        // Get appropriate icon for product category
                                        function getCategoryIcon(category) {
                                            // Using emojis as placeholders, but ideally these would be images
                                            switch (category) {
                                                case 'bras': return 'ðŸ‘™';
                                                case 'bottoms': return 'ðŸ©²';
                                                case 'maternity': return 'ðŸ¤°';
                                                case 'shapewear': return 'â³';
                                                default: return 'ðŸ›ï¸';
                                            }
                                        }

                                        // Populate product lists in the admin modal
                                        function populateProductLists() {
                                            const availableProductsList = document.getElementById('available-products');
                                            const trailFavoritesList = document.getElementById('trail-favorites-list');

                                            if (!availableProductsList || !trailFavoritesList) return;

                                            availableProductsList.innerHTML = '';
                                            trailFavoritesList.innerHTML = '';

                                            products.forEach(product => {
                                                const productItem = document.createElement('div');
                                                productItem.className = 'product-list-item';
                                                productItem.innerHTML = `
                    <span>${product.name} - R ${product.price.toFixed(2)}</span>
                    <div class="product-list-actions">
                        ${product.isTrailFavorite ?
                                                        `<button class="delete-btn" onclick="removeFromTrailFavorites(${product.id})">Remove</button>` :
                                                        `<button class="edit-btn" onclick="addToTrailFavorites(${product.id})">Add</button>`
                                                    }
                    </div>
                `;

                                                if (product.isTrailFavorite) {
                                                    trailFavoritesList.appendChild(productItem);
                                                } else {
                                                    availableProductsList.appendChild(productItem);
                                                }
                                            });
                                        }

                                        // Add product to Trail Favorites
                                        function addToTrailFavorites(productId) {
                                            const product = products.find(p => p.id === productId);
                                            if (product) {
                                                product.isTrailFavorite = true;
                                                saveProductsToStorage();
                                                populateProductLists();
                                                renderTrailFavorites();
                                            }
                                        }

                                        // Remove product from Trail Favorites
                                        function removeFromTrailFavorites(productId) {
                                            const product = products.find(p => p.id === productId);
                                            if (product) {
                                                product.isTrailFavorite = false;
                                                saveProductsToStorage();
                                                populateProductLists();
                                                renderTrailFavorites();
                                            }
                                        }

                                        // Save Trail Favorites changes
                                        function saveTrailFavorites() {
                                            saveProductsToStorage();
                                            renderTrailFavorites();
                                            closeModal('editTrailFavoritesModal');
                                            alert('Favorites updated successfully!');
                                        }


                                        // Simple Cart
                                        const CART_KEY = 'auraflex_cart_v1';
                                        function loadCart() {
                                            try {
                                                const raw = localStorage.getItem(CART_KEY);
                                                if (!raw) return [];
                                                const parsed = JSON.parse(raw);
                                                return Array.isArray(parsed) ? parsed : [];
                                            } catch (_) {
                                                return [];
                                            }
                                        }
                                        function saveCart(cart) {
                                            try { localStorage.setItem(CART_KEY, JSON.stringify(cart)); } catch (_) { }
                                        }
                                        function getCartCount(cart) {
                                            return cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
                                        }
                                        function updateCartBadge() {
                                            const badge = document.getElementById('cartBadge');
                                            if (!badge) return;
                                            const cart = loadCart();
                                            const count = getCartCount(cart);
                                            if (count > 0) {
                                                badge.textContent = String(count);
                                                badge.style.display = 'flex';
                                            } else {
                                                badge.style.display = 'none';
                                            }
                                        }
                                        // Promo + Shipping
                                        const PROMO_KEY = 'auraflex_promo_v1';
                                        function loadPromo() {
                                            try { return JSON.parse(localStorage.getItem(PROMO_KEY)) || { code: '', discountRate: 0 }; } catch (_) { return { code: '', discountRate: 0 }; }
                                        }
                                        function savePromo(state) {
                                            try { localStorage.setItem(PROMO_KEY, JSON.stringify(state)); } catch (_) { }
                                        }
                                        function applyPromo() {
                                            const input = document.getElementById('promoCode');
                                            if (!input) return;
                                            const code = (input.value || '').trim().toUpperCase();
                                            if (code === 'ROOTED15') {
                                                savePromo({ code, discountRate: 0.15 });
                                                alert('Promo code applied: 15% off');
                                            } else if (code === '') {
                                                savePromo({ code: '', discountRate: 0 });
                                            } else {
                                                alert('Invalid promo code');
                                            }
                                            renderCart();
                                        }
                                        function computeShipping(subtotal) {
                                            const regionEl = document.getElementById('shippingRegion');
                                            const region = regionEl ? regionEl.value : 'sa';
                                            if (region === 'intl') return 300;
                                            return subtotal >= 1000 ? 0 : 60;
                                        }
                                        function renderCart() {
                                            const container = document.getElementById('cartItems');
                                            const totalEl = document.getElementById('cartTotal');
                                            const shippingEl = document.getElementById('shippingAmount');
                                            const shippingLineEl = document.getElementById('cartShipping');
                                            const subtotalEl = document.getElementById('cartSubtotal');
                                            const discountEl = document.getElementById('cartDiscount');
                                            const checkoutBtn = document.getElementById('checkoutBtn');
                                            const promoInput = document.getElementById('promoCode');
                                            if (!container || !totalEl) return;
                                            const cart = loadCart();
                                            container.innerHTML = '';
                                            let subtotal = 0;
                                            cart.forEach(line => {
                                                const product = products.find(p => p.id === line.productId);
                                                if (!product) return;
                                                const lineTotal = product.price * (line.quantity || 1);
                                                subtotal += lineTotal;
                                                const row = document.createElement('div');
                                                row.className = 'cart-item';
                                                row.innerHTML = `
                    <div class=\"cart-item-title\">${product.name}</div>
                    <div style=\"text-align:right;\">R ${lineTotal.toFixed(2)}</div>
                    <div class=\"cart-qty-controls\" style="display:flex; gap:0.5rem; align-items:center;">
                        <button class=\"qty-btn\" onclick=\"decreaseQty(${product.id})\">-</button>
                        <span>${line.quantity || 1}</span>
                        <button class=\"qty-btn\" onclick=\"increaseQty(${product.id})\">+</button>
                    </div>
                    <div style=\"text-align:right;\">
                        <button class=\"remove-line\" onclick=\"removeLine(${product.id})\" style="color:red; background:none; border:none; cursor:pointer;">Remove</button>
                    </div>
                `;
                                                container.appendChild(row);
                                            });
                                            const promo = loadPromo();
                                            if (promoInput) promoInput.value = promo.code || '';
                                            const discount = promo.discountRate ? subtotal * promo.discountRate : 0;
                                            const shipping = computeShipping(subtotal - discount);
                                            if (shippingEl) shippingEl.textContent = `Shipping: R ${shipping.toFixed(2)}`;
                                            if (shippingLineEl) shippingLineEl.textContent = `R ${shipping.toFixed(2)}`;
                                            if (subtotalEl) subtotalEl.textContent = `R ${subtotal.toFixed(2)}`;
                                            if (discountEl) discountEl.textContent = `- R ${discount.toFixed(2)}`;
                                            const total = Math.max(0, subtotal - discount) + shipping;
                                            totalEl.textContent = `R ${total.toFixed(2)}`;
                                            if (checkoutBtn) {
                                                const isEmpty = subtotal <= 0;
                                                checkoutBtn.disabled = isEmpty;
                                                checkoutBtn.style.opacity = isEmpty ? '0.6' : '1';
                                                checkoutBtn.style.cursor = isEmpty ? 'not-allowed' : 'pointer';
                                            }
                                        }
                                        function increaseQty(productId) {
                                            const cart = loadCart();
                                            const line = cart.find(l => l.productId === productId);
                                            if (!line) return;
                                            line.quantity = (line.quantity || 1) + 1;
                                            saveCart(cart);
                                            updateCartBadge();
                                            renderCart();
                                        }
                                        function decreaseQty(productId) {
                                            const cart = loadCart();
                                            const line = cart.find(l => l.productId === productId);
                                            if (!line) return;
                                            line.quantity = Math.max(1, (line.quantity || 1) - 1);
                                            saveCart(cart);
                                            updateCartBadge();
                                            renderCart();
                                        }
                                        function removeLine(productId) {
                                            let cart = loadCart();
                                            cart = cart.filter(l => l.productId !== productId);
                                            saveCart(cart);
                                            updateCartBadge();
                                            renderCart();
                                        }
                                        function quickAdd(productId) {
                                            const product = products.find(p => p.id === productId);
                                            if (!product) return;
                                            const cart = loadCart();
                                            const existing = cart.find(i => i.productId === productId);
                                            if (existing) {
                                                existing.quantity = (existing.quantity || 1) + 1;
                                            } else {
                                                cart.push({ productId, quantity: 1 });
                                            }
                                            saveCart(cart);
                                            updateCartBadge();
                                            openCart(); // Open cart to show feedback
                                        }

                                        function openProductPage(productId, productName, productPrice) {
                                            const encodedName = encodeURIComponent(productName);
                                            const url = `../Select/select.html?id=${productId}&name=${encodedName}&price=${productPrice}`;
                                            window.location.href = url;
                                        }

                                        function openCategoryPage(category) {
                                            const url = `../category_page.html?category=${category}`;
                                            window.location.href = url;
                                        }
                                        function openCart() {
                                            openModal('cartModal');
                                            renderCart();
                                        }

                                        function openCheckout() {
                                            const cart = loadCart();
                                            if (!cart || cart.length === 0) return;
                                            closeModal('cartModal');
                                            setTimeout(() => {
                                                openModal('checkoutModal');
                                            }, 50);
                                        }

                                        // Modal Functions
                                        function openModal(modalId) {
                                            const modal = document.getElementById(modalId);
                                            if (!modal) return;
                                            modal.style.display = 'flex';
                                            if (modalId === 'cartModal') {
                                                modal.classList.add('show-right');
                                                document.body.style.overflow = 'hidden';
                                            }
                                        }

                                        function closeModal(modalId) {
                                            const modal = document.getElementById(modalId);
                                            if (!modal) return;
                                            modal.style.display = 'none';
                                            if (modalId === 'cartModal') {
                                                modal.classList.remove('show-right');
                                                document.body.style.overflow = '';
                                            }
                                        }

                                        // Header mobile menu toggle
                                        function toggleNav(forceState) {
                                            const nav = document.querySelector('.nav-links');
                                            const overlay = document.getElementById('mobileOverlay');
                                            if (!nav || !overlay) return;
                                            const isOpen = typeof forceState === 'boolean' ? forceState : !nav.classList.contains('open');
                                            if (isOpen) {
                                                nav.classList.add('open');
                                                overlay.classList.add('show');
                                                document.body.style.overflow = 'hidden';
                                            } else {
                                                nav.classList.remove('open');
                                                overlay.classList.remove('show');
                                                document.body.style.overflow = '';
                                            }
                                        }

                                        // Image Upload Handling
                                        function handleImageUpload(input) {
                                            const uploadedImagesContainer = document.getElementById('uploadedImages');
                                            if (!uploadedImagesContainer) return;

                                            Array.from(input.files).forEach(file => {
                                                const reader = new FileReader();
                                                reader.onload = function (e) {
                                                    const imageDiv = document.createElement('div');
                                                    imageDiv.className = 'uploaded-image';
                                                    imageDiv.innerHTML = `<img src="${e.target.result}" style="width:100px; height:100px; object-fit:cover;">`;
                                                    uploadedImagesContainer.appendChild(imageDiv);
                                                };
                                                reader.readAsDataURL(file);
                                            });
                                        }

                                        // Form Handling
                                        const addProductForm = document.getElementById('addProductForm');
                                        if (addProductForm) {
                                            addProductForm.addEventListener('submit', function (e) {
                                                e.preventDefault();
                                                const newProduct = {
                                                    id: products.length ? Math.max(...products.map(p => p.id)) + 1 : 1,
                                                    name: document.getElementById('productName').value,
                                                    price: parseFloat(document.getElementById('productPrice').value),
                                                    rating: Math.max(1, Math.min(5, parseFloat(document.getElementById('productRating').value))),
                                                    category: document.getElementById('productCategory').value,
                                                    isTrailFavorite: false
                                                };
                                                products.push(newProduct);
                                                saveProductsToStorage();
                                                alert('Product added successfully!');
                                                closeModal('addProductModal');
                                                populateProductLists();
                                                addProductForm.reset();
                                            });
                                        }

                                        // Close modal when clicking outside
                                        window.addEventListener('click', function (e) {
                                            if (e.target.classList.contains('modal')) {
                                                e.target.style.display = 'none';
                                                if (e.target.id === 'cartModal') {
                                                    e.target.classList.remove('show-right');
                                                    document.body.style.overflow = '';
                                                }
                                            }
                                        });

                                        // Checkout submit handler
                                        const checkoutForm = document.getElementById('checkoutForm');
                                        if (checkoutForm) {
                                            checkoutForm.addEventListener('submit', function (e) {
                                                e.preventDefault();
                                                alert('Order placed! A confirmation has been sent to your email.');
                                                saveCart([]);
                                                updateCartBadge();
                                                closeModal('checkoutModal');
                                            });
                                        }

                                        // Search Modal Functions
                                        function openSearch() {
                                            openModal('searchModal');
                                            const searchInput = document.getElementById('searchInput');
                                            if (searchInput) {
                                                setTimeout(() => searchInput.focus(), 100);
                                                searchInput.value = '';
                                                const results = document.getElementById('searchResults');
                                                if (results) results.innerHTML = '';

                                                searchInput.oninput = performSearch;
                                            }
                                        }

                                        function performSearch() {
                                            const searchInput = document.getElementById('searchInput');
                                            const searchResults = document.getElementById('searchResults');
                                            if (!searchInput || !searchResults) return;

                                            const query = searchInput.value.trim().toLowerCase();
                                            if (query.length === 0) {
                                                searchResults.innerHTML = '';
                                                return;
                                            }

                                            const filteredProducts = products.filter(product =>
                                                product.name.toLowerCase().includes(query) ||
                                                product.category.toLowerCase().includes(query)
                                            );

                                            searchResults.innerHTML = '';
                                            if (filteredProducts.length === 0) {
                                                searchResults.innerHTML = '<div style="padding:1rem; text-align:center; color:#666;">No products found.</div>';
                                                return;
                                            }

                                            filteredProducts.forEach(product => {
                                                const resultItem = document.createElement('div');
                                                resultItem.className = 'search-result-item';
                                                resultItem.onclick = () => {
                                                    closeModal('searchModal');
                                                    openProductPage(product.id, product.name, product.price);
                                                };
                                                resultItem.innerHTML = `
                    <div style="font-size:1.5rem;">${getCategoryIcon(product.category)}</div>
                    <div>
                        <div style="font-weight:600;">${product.name}</div>
                        <div style="color:#888;">R ${product.price.toFixed(2)}</div>
                    </div>
                `;
                                                searchResults.appendChild(resultItem);
                                            });
                                        }

                                        // Account Modal Functions
                                        function openAccount() {
                                            openModal('accountModal');
                                        }
                                        function handleSignIn() { closeModal('accountModal'); alert('Sign in functionality would be implemented here'); }
                                        function handleOrders() { closeModal('accountModal'); alert('Orders page would be implemented here'); }
                                        function handleProfile() { closeModal('accountModal'); alert('Profile page would be implemented here'); }
                                    </script>

                                    <!-- Search Modal -->
                                    <div id="searchModal" class="modal" style="display:none;">
                                        <div class="modal-content search-panel">
                                            <div class="search-header"
                                                style="display:flex; justify-content:space-between; margin-bottom:1rem;">
                                                <h2>Search Products</h2>
                                                <button class="cancel-btn" onclick="closeModal('searchModal')"
                                                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">Ã—</button>
                                            </div>
                                            <div class="search-input-container">
                                                <input id="searchInput" type="text" placeholder="Search for products..."
                                                    autocomplete="off">
                                            </div>
                                            <div id="searchResults" class="search-results" style="margin-top:1rem;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Account Modal -->
                                    <div id="accountModal" class="modal" style="display:none;">
                                        <div class="modal-content account-panel" style="max-width:400px;">
                                            <div class="account-header"
                                                style="display:flex; justify-content:space-between; margin-bottom:2rem;">
                                                <h2>Account</h2>
                                                <button class="cancel-btn" onclick="closeModal('accountModal')"
                                                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">Ã—</button>
                                            </div>
                                            <div class="account-content"
                                                style="display:flex; flex-direction:column; gap:1rem;">
                                                <button onclick="handleSignIn()"
                                                    style="background:var(--text-color); color:white; padding:1rem; border:none; border-radius:6px; font-weight:600; cursor:pointer;">Sign
                                                    in</button>
                                                <div style="display:flex; gap:1rem;">
                                                    <button onclick="handleOrders()"
                                                        style="flex:1; padding:0.8rem; border:1px solid #ddd; background:white; border-radius:6px; cursor:pointer;">Orders</button>
                                                    <button onclick="handleProfile()"
                                                        style="flex:1; padding:0.8rem; border:1px solid #ddd; background:white; border-radius:6px; cursor:pointer;">Profile</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
</body>

</html>